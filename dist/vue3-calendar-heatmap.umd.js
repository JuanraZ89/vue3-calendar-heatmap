(function(i,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("tippy.js")):typeof define=="function"&&define.amd?define(["exports","vue","tippy.js"],e):(i=typeof globalThis<"u"?globalThis:i||self,e(i.CalendarHeatmap={},i.Vue,i.tippy))})(this,function(i,e,u){"use strict";var ye=Object.defineProperty;var De=(i,e,u)=>e in i?ye(i,e,{enumerable:!0,configurable:!0,writable:!0,value:u}):i[e]=u;var E=(i,e,u)=>De(i,typeof e!="symbol"?e+"":e,u);const d=class d{constructor(a,r,l){E(this,"startDate");E(this,"endDate");E(this,"max");E(this,"_values");E(this,"_firstFullWeekOfMonths");E(this,"_activities");E(this,"_calendar");this.endDate=this.parseDate(a),this.max=l||Math.ceil(Math.max(...r.map(c=>c.count))/5*4),this.startDate=this.shiftDate(a,-d.DAYS_IN_ONE_YEAR),this._values=r}set values(a){this.max=Math.ceil(Math.max(...a.map(r=>r.count))/5*4),this._values=a,this._firstFullWeekOfMonths=void 0,this._calendar=void 0,this._activities=void 0}get values(){return this._values}get activities(){if(!this._activities){this._activities=new Map;for(let a=0,r=this.values.length;a<r;a++)this._activities.set(this.keyDayParser(this.values[a].date),{count:this.values[a].count,colorIndex:this.getColorIndex(this.values[a].count)})}return this._activities}get weekCount(){return this.getDaysCount()/d.DAYS_IN_WEEK}get calendar(){if(!this._calendar){let a=this.shiftDate(this.startDate,-this.getCountEmptyDaysAtStart());a=new Date(a.getFullYear(),a.getMonth(),a.getDate()),this._calendar=new Array(this.weekCount);for(let r=0,l=this._calendar.length;r<l;r++){this._calendar[r]=new Array(d.DAYS_IN_WEEK);for(let c=0;c<d.DAYS_IN_WEEK;c++){const s=this.activities.get(this.keyDayParser(a));this._calendar[r][c]={date:new Date(a.valueOf()),count:s?s.count:void 0,colorIndex:s?s.colorIndex:0},a.setDate(a.getDate()+1)}}}return this._calendar}get firstFullWeekOfMonths(){if(!this._firstFullWeekOfMonths){const a=this.calendar;this._firstFullWeekOfMonths=[];for(let r=1,l=a.length;r<l;r++){const c=a[r-1][0].date,s=a[r][0].date;(c.getFullYear()<s.getFullYear()||c.getMonth()<s.getMonth())&&this._firstFullWeekOfMonths.push({value:s.getMonth(),index:r})}}return this._firstFullWeekOfMonths}getColorIndex(a){return a==null?0:a<=0?1:a>=this.max?5:Math.ceil(a*100/this.max*.03)+1}getCountEmptyDaysAtStart(){return this.startDate.getDay()}getCountEmptyDaysAtEnd(){return d.DAYS_IN_WEEK-1-this.endDate.getDay()}getDaysCount(){return d.DAYS_IN_ONE_YEAR+1+this.getCountEmptyDaysAtStart()+this.getCountEmptyDaysAtEnd()}shiftDate(a,r){const l=new Date(a);return l.setDate(l.getDate()+r),l}parseDate(a){return a instanceof Date?a:new Date(a)}keyDayParser(a){const r=this.parseDate(a);return String(r.getFullYear())+String(r.getMonth()).padStart(2,"0")+String(r.getDate()).padStart(2,"0")}};E(d,"DEFAULT_RANGE_COLOR_LIGHT",["#ebedf0","#dae2ef","#c0ddf9","#73b3f3","#3886e1","#17459e"]),E(d,"DEFAULT_RANGE_COLOR_DARK",["#1f1f22","#1e334a","#1d466c","#1d5689","#1d69ac","#1B95D1"]),E(d,"DEFAULT_LOCALE",{months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],on:"on",less:"Less",more:"More"}),E(d,"DEFAULT_TOOLTIP_UNIT","contributions"),E(d,"DAYS_IN_ONE_YEAR",365),E(d,"DAYS_IN_WEEK",7),E(d,"SQUARE_SIZE",10);let o=d;const F=e.defineComponent({name:"CalendarHeatmap",props:{showFutureDays:{type:Boolean,default:!1},endDate:{required:!0},max:{type:Number},rangeColor:{type:Array},values:{type:Array,required:!0},locale:{type:Object},tooltip:{type:Boolean,default:!0},tooltipUnit:{type:String,default:o.DEFAULT_TOOLTIP_UNIT},tooltipFormatter:{type:Function},vertical:{type:Boolean,default:!1},noDataText:{type:[Boolean,String],default:null},round:{type:Number,default:0},darkMode:Boolean},emits:["dayClick"],setup(t){const a=o.SQUARE_SIZE/5,r=o.SQUARE_SIZE+a,l=Math.ceil(o.SQUARE_SIZE*2.5),c=r*3,s=o.SQUARE_SIZE+o.SQUARE_SIZE/2,h=o.SQUARE_SIZE+o.SQUARE_SIZE/2,_=`translate(${l}, ${s})`,D=e.ref(null),A=e.ref(new Date),f=e.ref(new o(t.endDate,t.values,t.max)),R=e.ref(0),p=e.ref(0),N=e.ref("0 0 0 0"),C=e.ref("0 0 0 0"),T=e.ref(""),w=e.ref(""),L=e.ref(""),y=e.ref({}),I=e.ref(t.rangeColor||(t.darkMode?o.DEFAULT_RANGE_COLOR_DARK:o.DEFAULT_RANGE_COLOR_LIGHT)),{values:ie,tooltipUnit:de,tooltipFormatter:Ee,noDataText:ce,max:he,vertical:Q,locale:_e}=e.toRefs(t),m=new Map;let S;function Z(){m.clear(),S?S.setInstances(Array.from(m.values())):S=u.createSingleton(Array.from(m.values()),{overrides:[],moveTransition:"transform 0.1s ease-out",allowHTML:!0})}function fe(n){if(t.tooltip){if(n.count!==void 0)return t.tooltipFormatter?t.tooltipFormatter(n,t.tooltipUnit):`<b>${n.count} ${t.tooltipUnit}</b> ${y.value.on} ${y.value.months[n.date.getMonth()]} ${n.date.getDate()}, ${n.date.getFullYear()}`;if(t.noDataText)return`${t.noDataText}`;if(t.noDataText!==!1)return`<b>No ${t.tooltipUnit}</b> ${y.value.on} ${y.value.months[n.date.getMonth()]} ${n.date.getDate()}, ${n.date.getFullYear()}`}}function me(n){return t.vertical?`translate(0, ${r*f.value.weekCount-(n+1)*r})`:`translate(${n*r}, 0)`}function Se(n){return t.vertical?`translate(${n*r}, 0)`:`translate(0, ${n*r})`}function ge(n){return t.vertical?{x:3,y:r*f.value.weekCount-r*n.index-r/4}:{x:r*n.index,y:r-a}}e.watch([e.toRef(t,"rangeColor"),e.toRef(t,"darkMode")],([n,g])=>{I.value=n||(g?o.DEFAULT_RANGE_COLOR_DARK:o.DEFAULT_RANGE_COLOR_LIGHT)}),e.watch(Q,n=>{n?(R.value=l+r*o.DAYS_IN_WEEK+c,p.value=s+r*f.value.weekCount+a,T.value=`translate(${l}, 0)`,w.value=`translate(0, ${s})`):(R.value=l+r*f.value.weekCount+a,p.value=s+r*o.DAYS_IN_WEEK,T.value=`translate(0, ${s})`,w.value=`translate(${l}, 0)`)},{immediate:!0}),e.watch([R,p],([n,g])=>N.value=` 0 0 ${n} ${g}`,{immediate:!0}),e.watch([R,p,I],([n,g,k])=>{L.value=Q.value?`translate(${l+r*o.DAYS_IN_WEEK}, ${s})`:`translate(${n-r*k.length-30}, ${g-h})`},{immediate:!0}),e.watch(_e,n=>y.value=n?{...o.DEFAULT_LOCALE,...n}:o.DEFAULT_LOCALE,{immediate:!0}),e.watch(I,n=>C.value=`0 0 ${o.SQUARE_SIZE*(n.length+1)} ${o.SQUARE_SIZE}`,{immediate:!0}),e.watch([ie,de,Ee,ce,he,I],()=>{f.value=new o(t.endDate,t.values,t.max),m.forEach(n=>n.destroy()),e.nextTick(Z)}),e.onMounted(Z),e.onBeforeUnmount(()=>{S==null||S.destroy(),m.forEach(n=>n.destroy())});function ue(n){if(S&&n.target&&n.target.classList.contains("vch__day__square")&&n.target.dataset.weekIndex!==void 0&&n.target.dataset.dayIndex!==void 0){const g=Number(n.target.dataset.weekIndex),k=Number(n.target.dataset.dayIndex);if(!isNaN(g)&&!isNaN(k)){const O=fe(f.value.calendar[g][k]);if(O){const B=m.get(n.target);B?B.setContent(O):B||(m.set(n.target,u(n.target,{content:O})),S.setInstances(Array.from(m.values())))}}}}return{SQUARE_BORDER_SIZE:a,SQUARE_SIZE:r,LEFT_SECTION_WIDTH:l,RIGHT_SECTION_WIDTH:c,TOP_SECTION_HEIGHT:s,BOTTOM_SECTION_HEIGHT:h,svg:D,heatmap:f,now:A,width:R,height:p,viewbox:N,daysLabelWrapperTransform:T,monthsLabelWrapperTransform:w,yearWrapperTransform:_,legendWrapperTransform:L,lo:y,legendViewbox:C,curRangeColor:I,getWeekPosition:me,getDayPosition:Se,getMonthLabelPosition:ge,initTippyLazy:ue}}}),M=(t,a)=>{const r=t.__vccOpts||t;for(const[l,c]of a)r[l]=c;return r},$=["viewBox"],b=["transform"],W=["x","y"],V=["transform"],v=["x","y"],Y=["x","y"],P=["x","y"],G=["transform"],K=["x"],H=["rx","ry","width","height","x","y"],z=["x","y"],j=["transform"],q=["transform"],J=["rx","ry","transform","width","height","data-week-index","data-day-index","onClick"],X={class:"vch__legend"},x={class:"vch__legend-left"},ee={class:"vch__legend-right"},te={class:"vch__legend"},ae=["viewBox","height"],re={class:"vch__legend__wrapper"},ne=["rx","ry","width","height","x"];function oe(t,a,r,l,c,s){return e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass({vch__container:!0,"dark-mode":t.darkMode})},[(e.openBlock(),e.createElementBlock("svg",{class:"vch__wrapper",ref:"svg",viewBox:t.viewbox},[e.createElementVNode("g",{class:"vch__months__labels__wrapper",transform:t.monthsLabelWrapperTransform},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.heatmap.firstFullWeekOfMonths,(h,_)=>(e.openBlock(),e.createElementBlock("text",{class:"vch__month__label",key:_,x:t.getMonthLabelPosition(h).x,y:t.getMonthLabelPosition(h).y},e.toDisplayString(t.lo.months[h.value]),9,W))),128))],8,b),e.createElementVNode("g",{class:"vch__days__labels__wrapper",transform:t.daysLabelWrapperTransform},[e.createElementVNode("text",{class:"vch__day__label",x:t.vertical?t.SQUARE_SIZE:0,y:t.vertical?t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE:20},e.toDisplayString(t.lo.days[1]),9,v),e.createElementVNode("text",{class:"vch__day__label",x:t.vertical?t.SQUARE_SIZE*3:0,y:t.vertical?t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE:44},e.toDisplayString(t.lo.days[3]),9,Y),e.createElementVNode("text",{class:"vch__day__label",x:t.vertical?t.SQUARE_SIZE*5:0,y:t.vertical?t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE:69},e.toDisplayString(t.lo.days[5]),9,P)],8,V),t.vertical?(e.openBlock(),e.createElementBlock("g",{key:0,class:"vch__legend__wrapper",transform:t.legendWrapperTransform},[e.createElementVNode("text",{x:t.SQUARE_SIZE*1.25,y:"8"},e.toDisplayString(t.lo.less),9,K),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.curRangeColor,(h,_)=>(e.openBlock(),e.createElementBlock("rect",{key:_,rx:t.round,ry:t.round,style:e.normalizeStyle({fill:h}),width:t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE,height:t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE,x:t.SQUARE_SIZE*1.75,y:t.SQUARE_SIZE*(_+1)},null,12,H))),128)),e.createElementVNode("text",{x:t.SQUARE_SIZE*1.25,y:t.SQUARE_SIZE*(t.curRangeColor.length+2)-t.SQUARE_BORDER_SIZE},e.toDisplayString(t.lo.more),9,z)],8,G)):e.createCommentVNode("",!0),e.createElementVNode("g",{class:"vch__year__wrapper",transform:t.yearWrapperTransform,onMouseover:a[0]||(a[0]=(...h)=>t.initTippyLazy&&t.initTippyLazy(...h))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.heatmap.calendar,(h,_)=>(e.openBlock(),e.createElementBlock("g",{class:"vch__month__wrapper",key:_,transform:t.getWeekPosition(_)},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h,(D,A)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:A},[t.showFutureDays||D.date<t.now?(e.openBlock(),e.createElementBlock("rect",{key:0,class:"vch__day__square",rx:t.round,ry:t.round,transform:t.getDayPosition(A),width:t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE,height:t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE,style:e.normalizeStyle({fill:t.curRangeColor[D.colorIndex]}),"data-week-index":_,"data-day-index":A,onClick:f=>t.$emit("dayClick",D)},null,12,J)):e.createCommentVNode("",!0)],64))),128))],8,q))),128))],40,j)],8,$)),e.createElementVNode("div",X,[e.renderSlot(t.$slots,"legend",{},()=>[e.createElementVNode("div",x,[e.renderSlot(t.$slots,"vch__legend-left")]),e.createElementVNode("div",ee,[e.renderSlot(t.$slots,"legend-right",{},()=>[e.createElementVNode("div",te,[e.createElementVNode("div",null,e.toDisplayString(t.lo.less),1),t.vertical?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("svg",{key:0,class:"vch__external-legend-wrapper",viewBox:t.legendViewbox,height:t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE},[e.createElementVNode("g",re,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.curRangeColor,(h,_)=>(e.openBlock(),e.createElementBlock("rect",{key:_,rx:t.round,ry:t.round,style:e.normalizeStyle({fill:h}),width:t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE,height:t.SQUARE_SIZE-t.SQUARE_BORDER_SIZE,x:t.SQUARE_SIZE*_},null,12,ne))),128))])],8,ae)),e.createElementVNode("div",null,e.toDisplayString(t.lo.more),1)])])])])])],2)}const U=M(F,[["render",oe]]);function le(t){t.component(U.name,U)}const se={install:le};i.CalendarHeatmap=U,i.Heatmap=o,i.default=se,Object.defineProperties(i,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=vue3-calendar-heatmap.umd.js.map
